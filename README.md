# MCP Proxy Server


ä¸€ä¸ªæ™ºèƒ½çš„MCPä»£ç†æœåŠ¡å™¨ï¼Œèšåˆå¹¶æœåŠ¡å¤šä¸ªMCPèµ„æºæœåŠ¡å™¨ï¼Œé€šè¿‡å•ä¸€æ¥å£æä¾›é«˜æ•ˆçš„MCPé€‰ç”¨ç­–ç•¥ã€‚è¯¥æœåŠ¡å™¨ä½œä¸ºä¸­å¤®æ¢çº½ï¼Œèƒ½å¤Ÿï¼š

- è¿æ¥å¹¶ç®¡ç†å¤šä¸ªMCPèµ„æºæœåŠ¡å™¨
- é€šè¿‡ç»Ÿä¸€æ¥å£æš´éœ²å…¶ç»„åˆèƒ½åŠ›
- å¤„ç†è¯·æ±‚åˆ°é€‚å½“åç«¯æœåŠ¡å™¨çš„æ™ºèƒ½è·¯ç”±
- èšåˆæ¥è‡ªå¤šä¸ªæ¥æºçš„å“åº”
- **æ™ºèƒ½é€‰æ‹©æœ€ä½³MCPæœåŠ¡å™¨**
- **å®æ—¶ç›‘æ§æœåŠ¡å™¨æ€§èƒ½å’Œå¥åº·çŠ¶æ€**
- **è‡ªåŠ¨æ•…éšœè½¬ç§»å’Œè´Ÿè½½å‡è¡¡**

## æ ¸å¿ƒç‰¹æ€§

### ğŸ§  æ™ºèƒ½MCPé€‰æ‹©ç­–ç•¥
å®ç°äº†5ç§æ™ºèƒ½é€‰æ‹©ç®—æ³•ï¼š

- è‡ªé€‚åº”é€‰æ‹©ç­–ç•¥ï¼šæ ¹æ®è¯·æ±‚ç±»å‹ï¼ˆæ€§èƒ½å…³é”®å‹ã€å¯é æ€§å…³é”®å‹ã€å¹³è¡¡å‹ï¼‰è‡ªåŠ¨é€‰æ‹©æœ€ä½³æœåŠ¡å™¨
- è´¨é‡è¯„åˆ†ç­–ç•¥ï¼šåŸºäºç»¼åˆè´¨é‡è¯„åˆ†é€‰æ‹©æœåŠ¡å™¨ï¼Œè€ƒè™‘æ€§èƒ½ã€å¯é æ€§ã€èƒ½åŠ›åŒ¹é…åº¦å’Œè´Ÿè½½å› å­
- æ€§èƒ½ä¼˜å…ˆç­–ç•¥ï¼šä¸“æ³¨äºå“åº”æ—¶é—´ä¼˜åŒ–ï¼Œé€‚åˆå¯¹å»¶è¿Ÿæ•æ„Ÿçš„åº”ç”¨åœºæ™¯
- è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼šé€‰æ‹©è´Ÿè½½æœ€ä½çš„æœåŠ¡å™¨ï¼Œç¡®ä¿èµ„æºåˆ†é…çš„å‡è¡¡æ€§
- è½®è¯¢ç­–ç•¥ï¼šä¿ç•™åŸæœ‰çš„ç®€å•è½®è¯¢åˆ†é…æ–¹å¼

### ğŸ“Š å®æ—¶æ€§èƒ½ç›‘æ§

å®ç°äº†å®Œæ•´çš„ç›‘æ§ä½“ç³»ï¼š
- æŒ‡æ ‡è·Ÿè¸ªï¼šå®æ—¶è·Ÿè¸ªæ¯ä¸ªæœåŠ¡å™¨çš„å“åº”æ—¶é—´ã€æˆåŠŸç‡ã€è´Ÿè½½å› å­ã€å¥åº·çŠ¶æ€
- è´¨é‡è¯„åˆ†ç³»ç»Ÿï¼š
  * æ€§èƒ½è¯„åˆ†ï¼šperformanceScore = Math.max(0, 1 - (responseTime / 5000))
  * å¯é æ€§è¯„åˆ†ï¼šreliabilityScore = isHealthy ? successRate : 0
  * èƒ½åŠ›åŒ¹é…è¯„åˆ†ï¼šcapabilityScore = 1.0 // é»˜è®¤å€¼ï¼Œå¯é€šè¿‡é…ç½®è°ƒæ•´
  * è´Ÿè½½è¯„åˆ†ï¼šåŸºäºè¯·æ±‚é¢‘ç‡çš„åŠ¨æ€è´Ÿè½½è¯„ä¼°ï¼Œè´Ÿè½½è¶Šä½ï¼Œè¯„åˆ†è¶Šé«˜ï¼ŒloadScore = 1 - min(1, totalRequests / max(1, timeSinceLastRequest / 1000)ï¼‰
  * ç»¼åˆè¯„åˆ† = æ€§èƒ½è¯„åˆ† Ã— 0.3 + å¯é æ€§è¯„åˆ† Ã— 0.3 + èƒ½åŠ›åŒ¹é…è¯„åˆ† Ã— 0.2 + è´Ÿè½½è¯„åˆ† Ã— 0.2
- æ•°æ®èšåˆï¼šå®æ—¶èšåˆå¤šä¸ªæœåŠ¡å™¨çš„æ€§èƒ½æŒ‡æ ‡ï¼Œæä¾›æ•´ä½“è§†å›¾

### ğŸ”„ æ™ºèƒ½æ•…éšœå¤„ç†
<img src="/docs/error_hand.png" width="100%" height="100%">

- è‡ªåŠ¨å¥åº·æ£€æŸ¥ï¼šå®šæœŸå¥åº·æ£€æŸ¥ï¼ˆé»˜è®¤30ç§’é—´éš”ï¼‰ï¼Œè‡ªåŠ¨æ ‡è®°ä¸å¥åº·çš„æœåŠ¡å™¨
- æ™ºèƒ½æ•…éšœå¤„ç†ï¼šæŒ‡æ•°é€€é¿é‡è¯•ç­–ç•¥ï¼Œå¯é…ç½®çš„æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œæ™ºèƒ½é”™è¯¯åˆ†ç±»
- é”™è¯¯éš”ç¦»ï¼šä¸€ä¸ªæœåŠ¡å™¨çš„å¤±è´¥ä¸ä¼šå½±å“å…¶ä»–æœåŠ¡å™¨çš„æ­£å¸¸è¿è¡Œ

### ğŸ›ï¸ ç›‘æ§ä»ªè¡¨æ¿
<img src="/docs/web_monitor.png" width="100%" height="100%">

æä¾›Webç•Œé¢å®æ—¶ç›‘æ§MCPæœåŠ¡å™¨çŠ¶æ€ï¼š

- å®æ—¶çŠ¶æ€æ˜¾ç¤ºï¼šæœåŠ¡å™¨å¥åº·çŠ¶æ€ã€æ€§èƒ½æŒ‡æ ‡çš„å®æ—¶å±•ç¤º
- æ€§èƒ½ç»Ÿè®¡ï¼šå“åº”æ—¶é—´ã€æˆåŠŸç‡ã€è´Ÿè½½ç­‰ç»Ÿè®¡ä¿¡æ¯çš„å¯è§†åŒ–
- APIæ¥å£ï¼šæä¾›RESTful APIç”¨äºç¨‹åºåŒ–ç›‘æ§
- è‡ªåŠ¨åˆ·æ–°ï¼š5ç§’è‡ªåŠ¨åˆ·æ–°æ•°æ®ï¼Œä¿æŒç›‘æ§ä¿¡æ¯çš„å®æ—¶æ€§

è®¿é—®åœ°å€: `http://localhost:3000/dashboard`


## é…ç½®

è¯·åœ¨config.jsonä¸­é…ç½®éœ€è¦ç®¡ç†çš„MCP

```json
{
  "servers": [
    {
      "name": "é«˜æ€§èƒ½æœåŠ¡å™¨",
      "transport": {
        "command": "/path/to/high-performance-server/build/index.js"
      },
      "priority": 1,
      "capabilities": ["tools", "resources"],
      "maxConcurrentRequests": 10
    },
    {
      "name": "ç¨³å®šæœåŠ¡å™¨",
      "transport": {
        "command": "npx",
        "args": ["@example/stable-mcp-server"]
      },
      "priority": 2,
      "capabilities": ["tools", "prompts"],
      "maxConcurrentRequests": 5
    },
    {
      "name": "SSEæœåŠ¡å™¨",
      "transport": {
        "type": "sse",
        "url": "http://example.com/mcp"
      },
      "priority": 3,
      "capabilities": ["resources", "prompts"],
      "maxConcurrentRequests": 8
    }
  ],
  "selectionStrategy": {
    "default": "adaptive",
    "fallback": "quality",
    "timeout": 5000,
    "maxRetries": 2,
    "healthCheckInterval": 30000
  },
  "monitoring": {
    "enabled": true,
    "metricsRetentionHours": 24,
    "alertThresholds": {
      "responseTime": 5000,
      "errorRate": 0.1,
      "unhealthyServers": 0.5
    }
  }
}
```

### é…ç½®é€‰é¡¹è¯´æ˜

#### æœåŠ¡å™¨é…ç½®
- `name`: æœåŠ¡å™¨åç§°
- `transport`: ä¼ è¾“é…ç½® (stdio æˆ– sse)
- `priority`: æœåŠ¡å™¨ä¼˜å…ˆçº§ (1-10, 1ä¸ºæœ€é«˜)
- `capabilities`: æœåŠ¡å™¨æ”¯æŒçš„èƒ½åŠ›åˆ—è¡¨
- `maxConcurrentRequests`: æœ€å¤§å¹¶å‘è¯·æ±‚æ•°

#### é€‰æ‹©ç­–ç•¥é…ç½®
- `default`: é»˜è®¤é€‰æ‹©ç­–ç•¥
- `fallback`: å¤‡ç”¨é€‰æ‹©ç­–ç•¥
- `timeout`: è¯·æ±‚è¶…æ—¶æ—¶é—´(ms)
- `maxRetries`: æœ€å¤§é‡è¯•æ¬¡æ•°
- `healthCheckInterval`: å¥åº·æ£€æŸ¥é—´éš”(ms)

#### ç›‘æ§é…ç½®
- `enabled`: æ˜¯å¦å¯ç”¨ç›‘æ§
- `metricsRetentionHours`: æŒ‡æ ‡ä¿ç•™æ—¶é—´(å°æ—¶)
- `alertThresholds`: å‘Šè­¦é˜ˆå€¼é…ç½®

## å¼€å‘
è¯·å°†é¡¹ç›®cloneåˆ°æœ¬åœ°

å®‰è£…ä¾èµ–:
```bash
pnpm install
```

æ„å»ºæœåŠ¡å™¨:
```bash
pnpm run build
```

å¼€å‘æ¨¡å¼ (è‡ªåŠ¨é‡å»º):
```bash
pnpm run watch
```

å¼€å‘æ¨¡å¼ (æŒç»­è¿è¡Œ):
```bash
# Stdio
pnpm run dev
# SSE
pnpm run dev:sse
```

## å®‰è£…

è¦ä¸Claude Desktopä¸€èµ·ä½¿ç”¨ï¼Œæ·»åŠ æœåŠ¡å™¨é…ç½®:

MacOS: `~/Library/Application Support/Claude/claude_desktop_config.json`
Windows: `%APPDATA%/Claude/claude_desktop_config.json`

```json
{
  "mcpServers": {
    "mcp-proxy": {
      "command": "/path/to/mcp-proxy-server/build/index.js",
      "env": {
        "MCP_CONFIG_PATH": "/absolute/path/to/your/config.json",
        "KEEP_SERVER_OPEN": "1"
      }
    }
  }
}
```

- `KEEP_SERVER_OPEN` å°†åœ¨å®¢æˆ·ç«¯æ–­å¼€è¿æ¥æ—¶ä¿æŒSSEè¿è¡Œã€‚å½“å¤šä¸ªå®¢æˆ·ç«¯è¿æ¥åˆ°MCPä»£ç†æ—¶å¾ˆæœ‰ç”¨ã€‚

## ç›‘æ§å’Œè°ƒè¯•

### ç›‘æ§ä»ªè¡¨æ¿
å¯åŠ¨ç›‘æ§ä»ªè¡¨æ¿:
```bash
# åœ¨ä»£ç ä¸­é›†æˆç›‘æ§ä»ªè¡¨æ¿
const dashboard = new MonitoringDashboard(metricsManager, healthMonitor, smartSelector, connectedClients);
dashboard.start(3000);
```

è®¿é—® `http://localhost:3000/dashboard` æŸ¥çœ‹å®æ—¶ç›‘æ§ç•Œé¢ã€‚

### APIæ¥å£
- `GET /api/servers/status` - è·å–æ‰€æœ‰æœåŠ¡å™¨çŠ¶æ€
- `GET /api/servers/metrics` - è·å–æ€§èƒ½æŒ‡æ ‡
- `GET /api/servers/health` - è·å–å¥åº·æ£€æŸ¥çŠ¶æ€
- `POST /api/servers/:serverName/health-check` - æ‰‹åŠ¨è§¦å‘å¥åº·æ£€æŸ¥
- `GET /api/servers/:serverName/details` - è·å–æœåŠ¡å™¨è¯¦ç»†ä¿¡æ¯

### è°ƒè¯•
ç”±äºMCPæœåŠ¡å™¨é€šè¿‡stdioé€šä¿¡ï¼Œè°ƒè¯•å¯èƒ½å…·æœ‰æŒ‘æˆ˜æ€§ã€‚æˆ‘ä»¬æ¨èä½¿ç”¨ [MCP Inspector](https://github.com/modelcontextprotocol/inspector)ï¼Œå¯é€šè¿‡åŒ…è„šæœ¬ä½¿ç”¨:

```bash
pnpm run inspector
```

Inspectorå°†åœ¨æµè§ˆå™¨ä¸­æä¾›è°ƒè¯•å·¥å…·çš„URLã€‚

## æ™ºèƒ½é€‰æ‹©ç­–ç•¥è¯¦è§£

### è‡ªé€‚åº”ç­–ç•¥å·¥ä½œåŸç†

1. **è¯·æ±‚ç±»å‹æ£€æµ‹**: æ ¹æ®è¯·æ±‚ç‰¹å¾è‡ªåŠ¨åˆ¤æ–­ç±»å‹
   - è¶…æ—¶æ—¶é—´ < 1ç§’ â†’ æ€§èƒ½å…³é”®å‹
   - ä¼˜å…ˆçº§ = high â†’ å¯é æ€§å…³é”®å‹
   - å…¶ä»– â†’ å¹³è¡¡å‹

2. **ç­–ç•¥é€‰æ‹©**:
   - æ€§èƒ½å…³é”®å‹: é€‰æ‹©å“åº”æ—¶é—´æœ€çŸ­çš„æœåŠ¡å™¨
   - å¯é æ€§å…³é”®å‹: é€‰æ‹©æˆåŠŸç‡æœ€é«˜çš„æœåŠ¡å™¨
   - å¹³è¡¡å‹: é€‰æ‹©ç»¼åˆè¯„åˆ†æœ€é«˜çš„æœåŠ¡å™¨

3. **è´¨é‡è¯„åˆ†è®¡ç®—**:
   ```
   ç»¼åˆè¯„åˆ† = æ€§èƒ½è¯„åˆ† Ã— 0.3 + å¯é æ€§è¯„åˆ† Ã— 0.3 + èƒ½åŠ›åŒ¹é…åº¦ Ã— 0.2 + è´Ÿè½½è¯„åˆ† Ã— 0.2
   ```

### æ•…éšœå¤„ç†æœºåˆ¶

1. **é‡è¯•ç­–ç•¥**: æŒ‡æ•°é€€é¿é‡è¯•ï¼Œé¿å…å¯¹æ•…éšœæœåŠ¡å™¨é€ æˆé¢å¤–å‹åŠ›
2. **æ•…éšœè½¬ç§»**: ä¸»æœåŠ¡å™¨å¤±è´¥æ—¶è‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ç”¨æœåŠ¡å™¨
3. **å¥åº·æ¢å¤**: å®šæœŸæ£€æŸ¥ä¸å¥åº·æœåŠ¡å™¨ï¼Œè‡ªåŠ¨æ¢å¤å¯ç”¨çŠ¶æ€

### æ€§èƒ½ä¼˜åŒ–

1. **è¿æ¥æ± ç®¡ç†**: å¤ç”¨è¿æ¥ï¼Œå‡å°‘å»ºç«‹è¿æ¥çš„å¼€é”€
2. **è¯·æ±‚ç¼“å­˜**: ç¼“å­˜å¸¸ç”¨è¯·æ±‚ç»“æœ
3. **è´Ÿè½½å‡è¡¡**: æ™ºèƒ½åˆ†é…è¯·æ±‚åˆ°è´Ÿè½½è¾ƒä½çš„æœåŠ¡å™¨
4. **æŒ‡æ ‡èšåˆ**: å®æ—¶èšåˆå¤šä¸ªæœåŠ¡å™¨çš„æ€§èƒ½æŒ‡æ ‡

## æœ€ä½³å®è·µ

1. **æœåŠ¡å™¨é…ç½®**: æ ¹æ®æœåŠ¡å™¨èƒ½åŠ›è®¾ç½®åˆé€‚çš„ä¼˜å…ˆçº§å’Œå¹¶å‘é™åˆ¶
2. **ç›‘æ§å‘Šè­¦**: é…ç½®åˆç†çš„å‘Šè­¦é˜ˆå€¼ï¼ŒåŠæ—¶å‘ç°æ€§èƒ½é—®é¢˜
3. **ç­–ç•¥é€‰æ‹©**: æ ¹æ®åº”ç”¨åœºæ™¯é€‰æ‹©åˆé€‚çš„é»˜è®¤ç­–ç•¥
4. **å®šæœŸç»´æŠ¤**: å®šæœŸæ£€æŸ¥æœåŠ¡å™¨å¥åº·çŠ¶æ€å’Œæ€§èƒ½æŒ‡æ ‡
5. **å®¹é‡è§„åˆ’**: æ ¹æ®è´Ÿè½½æƒ…å†µè°ƒæ•´æœåŠ¡å™¨èµ„æºé…ç½®

è¿™ä¸ªå¢å¼ºç‰ˆçš„MCPä»£ç†æœåŠ¡å™¨ä¸ºAgentæä¾›äº†æ™ºèƒ½ã€å¯é çš„MCPé€‰æ‹©èƒ½åŠ›ï¼Œç¡®ä¿åœ¨å„ç§åœºæ™¯ä¸‹éƒ½èƒ½é€‰æ‹©åˆ°æœ€é€‚åˆçš„MCPæœåŠ¡å™¨ï¼Œå¤§å¤§æå‡äº†ç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½å’Œå¯é æ€§ã€‚

